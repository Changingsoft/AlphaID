@inject OrganizationMemberManager memberManager
@inject OrganizationManager organizationManager
@{
    Layout = "/Pages/Shared/_Layout.cshtml";
    var IsOwner = false;
    var anchor = this.ViewContext.RouteData.Values["anchor"]?.ToString();
    if (this.User.Identity!.IsAuthenticated)
    {
        var subjectId = this.User.SubjectId();
        if (anchor != null && subjectId != null)
        {
            var orgs = await organizationManager.FindByAnchorAsync(anchor);
            if (orgs.Count() == 1)
            {
                var org = orgs.First();
                IsOwner = (await memberManager.GetMembersAsync(org)).Any(m => m.PersonId == subjectId && m.IsOwner);
            }
        }

    }
}

@section Heads{
    @await RenderSectionAsync("Heads", false)
}

@section Navbar{
    <header class="navbar-expand-md">
        <div class="collapse navbar-collapse" id="navbar-menu">
            <div class="navbar">
                <div class="container-xl">
                    <ul class="navbar-nav">
                        <li class="nav-item" asp-path="/Organization" asp-match-prefix="false">
                            <a class="nav-link" asp-page="/Index" asp-route-anchor="@ViewContext.RouteData.Values["anchor"]">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <use xlink:href="/lib/tabler-icons/tabler-sprite-nostroke.svg#tabler-home-2"></use>
                                    </svg>
                                </span>
                                <span class="nav-link-title">
                                    @localizer["Overview"]
                                </span>
                            </a>
                        </li>
                        <li class="nav-item" asp-path="/Organization/People">
                            <a class="nav-link" asp-page="/People/Index" asp-route-anchor="@ViewContext.RouteData.Values["anchor"]">
                                <span class="nav-link-icon d-md-none d-lg-inline-block">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                        <use xlink:href="/lib/tabler-icons/tabler-sprite-nostroke.svg#tabler-user"></use>
                                    </svg>
                                </span>
                                <span class="nav-link-title">
                                    @localizer["People"]
                                </span>
                            </a>
                        </li>
                        @if (IsOwner)
                        {
                            <li class="nav-item" asp-path="/Organization/Settings">
                                <a class="nav-link" asp-page="/Settings/Index" asp-route-anchor="@ViewContext.RouteData.Values["anchor"]">
                                    <span class="nav-link-icon d-md-none d-lg-inline-block">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                            <use xlink:href="/lib/tabler-icons/tabler-sprite-nostroke.svg#tabler-building"></use>
                                        </svg>
                                    </span>
                                    <span class="nav-link-title">
                                        @localizer["Settings"]
                                    </span>
                                </a>
                            </li>
                        }
                    </ul>
                    <div class="my-2 my-md-0 flex-grow-1 flex-md-grow-0 order-first order-md-last">
                    </div>
                </div>
            </div>
        </div>
    </header>

}

@RenderBody()

@section Scripts
    {
    @RenderSection("Scripts", false)
}