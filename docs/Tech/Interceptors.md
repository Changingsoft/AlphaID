# Alpha ID 中的拦截器

## 概述

拦截器（Interceptor）是一种机制，允许在某些业务逻辑流水线执行的前后插入自定义的业务逻辑，或者在执行前拦截并更改程序行为。

> 过滤器（Filter）也是一种业务逻辑流水线上的一种插入自定义机制，但与拦截器不同，过滤器通常不应对业务逻辑流水线造成影响，也不能改变业务逻辑流水线行为。

## 设计

所有拦截器都应实现 IInterceptor 接口。这是一个标记接口，不包含成员。接口的作用是可以在依赖注入系统中按类型归并所有拦截器。

如果你是业务程序开发者，设计具体的拦截器接口时，应继承 IInterceptor 接口。

### 拦截器接口方法

特定业务的拦截器接口，通常都应包括两个方法，一个在主业务逻辑执行前执行，另一个在主业务逻辑执行后执行。

主业务逻辑执行前的方法应提供一种机制，使拦截器能够改变或决定阻止主业务逻辑的执行。

主业务逻辑执行后的方法不应提供返回值和out参数，因为主业务逻辑已经执行完成。在执行后方法中，通常也不宜再引发异常，或者执行其他有副作用的行为（如回滚数据库事务等）。

### 拦截器执行过程

施加在流水线上的拦截器可能不止1个，因此你需要考虑他们的执行过程。通常来说，不规定拦截器的执行顺序，任何执行顺序都应当是等效的。

> 但是，一般地在执行主逻辑前，拦截器按一定顺序执行，那么在执行主逻辑后，一般应按相反顺序执行。这个行为可以利用Stack来保证。

所有施加的拦截器都应该被执行，特别是对于主逻辑执行前方法的处理。开发人员应当收集所有拦截器的执行前方法产生的结果，然后集中评估是否需要执行主逻辑。

