@page "{id}"
@model             AdministratorsModel
@{
}
<partial name="_OrganizationSummary" model="@this.Model.Organization" />

<h2>组织的管理员</h2>
<form method="post">
    <ul>
        @foreach (var administrator in this.Model.Administrators)
        {
            <li>
                <a asp-page="/People/Detail/Index" asp-route-id="@administrator.PersonId">@administrator.Name</a>
                @if (administrator.IsOrganizationCreator)
                {
                    <span>（创建者）</span>
                }
                else
                {
                    <button type="submit" class="btn btn-sm btn-primary" asp-page-handler="SetCreator" asp-route-id="@Model.Id" asp-route-administratorId="@administrator.PersonId">设为创建者</button>
                    <button type="submit" class="btn btn-sm btn-danger" asp-page-handler="RemoveAdministrator" asp-route-id="@Model.Id" asp-route-administratorId="@administrator.PersonId">移除</button>
                }
            </li>
        }
    </ul>
</form>

<h2>添加管理员</h2>
<form method="post" asp-page-handler="AddAdministrator" asp-route-id="@this.Model.Id">
    <div class="form-group">
        <input id="searchPerson" type="text" class="form-control" />
    </div>

    <div class="form-group">
        <label asp-for="Input.Name"></label>
        <input asp-for="Input.Name" class="form-control" readonly />
        <span asp-validation-for="Input.Name"></span>
    </div>
    <input asp-for="Input.PersonId" type="hidden" />
    <input asp-for="Input.PhoneticSearchHint" type="hidden" />
    <button type="submit" class="btn btn-primary">添加</button>
</form>

@section scripts
    {
    <script>
        $(function () {
            $("#searchPerson").autocomplete({
                source: "@(this.Url.Action("SearchPerson", "IdService"))",
                minLength: 2,
                select: function (event, ui) {
                    $(this).val(ui.item.name);
                    $("[name='Input.PersonId']").val(ui.item.subjectId);
                    $("[name='Input.Name']").val(ui.item.name);
                    $("[name='Input.PhoeticSearchHint']").val(ui.item.phoneticSearchHint);

                    return false;
                }
            })
                .autocomplete("instance")._renderItem = function (ul, item) {
                    var div = $("<div>");
                    div.append("<p>" + item.name + "</p>")
                    div.append("<ul>").append("<li>ddd</li>");
                    var li = $("<li>").append(div);
                    return li.appendTo(ul);
                };

            $("#personSearch").on("blur", function () {
                if ($(this).val() == "") {
                    $("[name='Input.Name']").val("");
                    $("[name='Input.PersonId']").val("");
                }
            });
        });
    </script>
}